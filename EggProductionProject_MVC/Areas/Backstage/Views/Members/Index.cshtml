 @model IEnumerable<EggProductionProject_MVC.Models.MemberVM.MemberVM>

@{
    ViewData["Title"] = "Index";
}
@section Styles {
    <style>
        .table-hover tbody tr:hover {
            background-color: #f0e68c !important; /* 淡黄色背景 */
            color: #333333 !important; /* 深色文字 */
        }
    </style>
}



<h2>Index</h2>

<nav>
	<div class="row">
		<div class="col-3">
			<label for="selectIsBlocked">是否被禁用:</label>
			<select id="selectIsBlocked" class="form-control">
				<option value="">全部</option>
				<option value="1">已封鎖</option>
				<option value="0">未封鎖</option>
			</select>
		</div>
		<div class="col-3">
			<label for="selectIsChickFarm">是否為雞農:</label>
			<select id="selectIsChickFarm" class="form-control">
				<option value="">全部</option>
				<option value="1">雞農</option>
				<option value="0">一般用戶</option>
			</select>
		</div>
		<div class="col-3" >
			<input  type="search" placeholder="搜尋關鍵字" id="inputSearch" class="form-control" />
		</div>
	</div>


</nav>




<p>

    <div>會員數量 : <span id="memberCount">@Model.Count()</span></div>
</p>

<div id="memberList">
    @* 将会员列表渲染为一个局部视图，以便AJAX请求时更新这一部分 *@
    @Html.Partial("_MemberListPartial", Model)
</div>




<div class="modal fade" id="editMemberModal" tabindex="-1" aria-labelledby="editMemberModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMemberModalLabel">修改會員資料</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editMemberForm">
                    <div class="mb-3">
                        <label for="memberName" class="form-label">會員名稱</label>
                        <input type="text" class="form-control" id="memberName" name="Name" required>
                    </div>
                    <div class="mb-3">
                        <label for="memberEmail" class="form-label">會員信箱</label>
                        <input type="email" class="form-control" id="memberEmail" name="Email" required>
                    </div>
                    <div class="mb-3">
                        <label for="memberPhone" class="form-label">聯絡電話</label>
                        <input type="text" class="form-control" id="memberPhone" name="Phone" required>
                    </div>
                    <div class="mb-3">
                        <label for="memberBirthDate" class="form-label">會員生日</label>
                        <input type="date" class="form-control" id="memberBirthDate" name="BirthDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="memberIsChickFarm" class="form-label">會員身份（雞農？）</label>
                        <select class="form-control" id="memberIsChickFarm" name="IsChickFarm">
                            <option value="1">雞農</option>
                            <option value="0">一般用戶</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="memberIsBlocked" class="form-label">是否禁用</label>
                        <select class="form-control" id="memberIsBlocked" name="IsBlocked">
                            <option value="1">禁用</option>
                            <option value="0">活耀</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="submit" class="btn btn-primary" id="saveMemberChanges">保存修改</button>
            </div>
        </div>
    </div>
</div>





@section Scripts {


    <script>


        //查詢會員的功能
        $(document).ready(function () {
            $('#inputSearch').on('keydown', function () {
                var keyword = $(this).val();

                $.ajax({
                    url: '@Url.Action("FilterMembers", "Members")',
                    type: 'GET',
                    data: { keyword: keyword },
                    success: function (result) {
                        $('#memberList').html(result); // 更新会员列表
                      
                    },
                    error: function () {
                        alert('發生錯誤，请稍後重試。');
                    }
                });
            });
        });



        //篩選雞農與禁用功能
        $(document).ready(function () {
            // 綁定篩選事件
            $('#selectIsBlocked, #selectIsChickFarm').change(function () {
                filterMembers();
            });

            function filterMembers() {
                var isBlocked = $('#selectIsBlocked').val();
                var isChickFarm = $('#selectIsChickFarm').val();

                $.ajax({
                    url: '@Url.Action("FilterMembers", "Members")',
                    type: 'GET',
                    data: {
                        isBlocked: isBlocked,
                        isChickFarm: isChickFarm
                    },
                    success: function (result) {
                        $('#memberList').html(result); // 更新會員列表
                        $('#memberCount').text($(result).find('tr').length); // 更新會員數量
                    },
                    error: function () {
                        alert('發生錯誤，請稍後重試。');
                    }
                });
            }
        });



        $(document).ready(function () {
            // 在每个修改按钮上绑定点击事件
            $('.edit-member-btn').on('click', function () {
                var memberId = $(this).data('member-id');

                // 发起AJAX请求获取会员数据
                $.get('/Members/GetMemberDetails', { id: memberId }, function (data) {
                    if (data) {
                        // 加载数据到Modal中
                        loadMemberData(data);

                        // 显示Modal
                        $('#editMemberModal').modal('show');
                    } else {
                        alert('无法加载会员数据，请稍后重试。');
                    }
                }).fail(function () {
                    alert('请求失败，请检查网络连接。');
                });
            });
        });



        
    
    </script>
} 