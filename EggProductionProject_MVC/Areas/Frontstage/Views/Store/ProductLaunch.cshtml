@model EggProductionProject_MVC.Areas.Frontstage.ViewModels.ProductLaunchViewModel

@{
    Layout = "_FrontLayout_store";
}


@section Styles {

    <style>
		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			user-select: none;
		}

		.btn-custom {
			background-color: #b8860b;
			color: white;
			border: none;
			border-radius: 5px;
			padding: 5px 15px;
			font-size: 16px;
		}

			.btn-custom:hover {
				background-color: #a37006;
			}

		/* 確認送出 Modal 的樣式 */
		#confirmSubmitModal .modal-content {
			background-color: #fff; /* 背景顏色 */
			border-radius: 10px; /* 圓角 */
		}

		#confirmSubmitModal .modal-header {
			border-bottom: none; /* 去掉邊框 */
		}

		#confirmSubmitModal .modal-footer {
			border-top: none; /* 去掉邊框 */
		}

		#confirmSubmitModal .modal-dialog {
			max-width: 400px; /* 調整寬度 */
		}

		/* 顏色與樣式的對齊 */
		#confirmSubmitModal .btn-secondary {
			background-color: #aebcc9;
			border: none;
		}

			#confirmSubmitModal .btn-secondary:hover {
				background-color: #6c757d;
			}

		#confirmSubmitModal .btn-primary {
			background-color: #cb9205;
			border: none;
		}

			#confirmSubmitModal .btn-primary:hover {
				background-color: #e0a800;
			}
		.modal-body {
			max-height: 70vh; /* 設定最大高度為視窗高度的70% */
			overflow-y: auto; /* 超出時自動顯示滾動條 */
		}

		.table th,
		.table td {
			text-align: center;
			padding: 15px;
			font-size: 16px;
		}

		.table thead th {
			background-color: #f8f9fa;
			border-bottom: 2px solid #b8860b !important;
			/* 強制應用棕色邊界 */
			color: #333;
			padding: 10px;
		}

		.toast-container {
			position: fixed;
			top: 20px;
			left: 50%;
			transform: translateX(-50%);
			z-index: 1055;
		}

		.search-box {
			display: flex;
			align-items: center;
			gap: 10px;
		}

			.search-box input {
				width: 200px;
				padding: 5px 10px;
				border-radius: 5px;
				border: 1px solid #dee2e6;
			}
    </style>

}

<div class=" col-12">
	<div class="page-title">
		<h5 class="mb-3">商品上架</h5>
	</div>

	<!-- 上方導覽列 -->
	<div class="tab-see mb-3">
		<ul class="nav nav-pills mb-1  tab-controll-n" id="pills-tab" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="pills-one-tab" data-bs-toggle="pill"
						data-bs-target="#pills-one" type="button" role="tab" aria-controls="pills-one"
						aria-selected="true">
					當前上架
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="pills-two-tab" data-bs-toggle="pill"
						data-bs-target="#pills-two" type="button" role="tab"
						aria-controls="pills-two" aria-selected="false">
					審核中
				</button>
			</li>
		</ul>
	</div>

	<!-- bootstrap的tab樣式，點擊導覽列會切換不同分頁-->
	<div class="tab-content" id="pills-tabContent">
		<!-- 導覽列第一頁 當前上架-->
		<div class="tab-pane fade show active" id="pills-one" role="tabpanel"
			 aria-labelledby="pills-one-tab">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<div class="notify-title d-flex align-items-center">
                    <img src="~/assets/brand/common/loudspeaker.svg" alt="loudspeaker" style="width: 24px;">					
					<span style="font-size: 14px;">流程提醒 : 完成新增後，經GOOD EGG官方審核，產品將自動上架!!</span>
				</div>
				<div class="search-box d-flex justify-content-end align-items-center mb-3">
					<!-- 新增商品的彈跳視窗按鈕 -->
					<button class="btn-custom me-2" data-bs-toggle="modal" data-bs-target="#exampleModalToggle">新增</button>
					<div class="input-group mb-3">
						<input type="text" class="form-control" placeholder="輸入商品名稱"
							   aria-label="輸入商品名稱" aria-describedby="button-addon2">
						<button class="btn btn-custom" type="button" id="button-addon2">
							<i class="fa-solid fa-magnifying-glass"></i>
						</button>
					</div>
				</div>
			</div>
			<table class="table">
				<thead>
					<tr>
						<th>商品名稱</th>
						<th>商品售價</th>
						<th>庫存(數)</th>
						<th>上架日期</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var product in Model.CurrentProducts)
					{
						<tr>
							<td>@product.productName</td>
							<td>$@product.price</td>
							<td>@product.stock</td>
							<td>@(product.launchTime.HasValue ? product.launchTime.Value.ToString("yyyy-MM-dd") : "")</td>
							<td><button class="btn btn-custom">編輯</button></td>
						</tr>
					}
				</tbody>
			</table>
		</div>
			
		<!-- 導覽列第二頁 審核中 -->
		<div class="tab-pane fade" id="pills-two" role="tabpanel"
			 aria-labelledby="pills-three-tab">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<div class="notify-title d-flex align-items-center">
					<img src="~/assets/brand/common/loudspeaker.svg" alt="" style="width: 24px;">
					<span style="font-size: 14px;">流程提醒 : 耐心等待GOOD EGG官方審核，商品將自動上架!!</span>
				</div>
				<div class="search-box d-flex justify-content-end align-items-center mb-3">
					<div class="input-group mb-3">
						<input type="text" class="form-control" placeholder="輸入商品名稱"
							   aria-label="輸入商品名稱" aria-describedby="button-addon2">
						<button class="btn btn-custom" type="button" id="button-addon2">
							<i class="fa-solid fa-magnifying-glass"></i>
						</button>
					</div>
				</div>
			</div>
				<table class="table">
					<thead>
						<tr>
							<th>商品名稱</th>
							<th>商品售價</th>
							<th>庫存(數)</th>
							<th>申請日期</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var product in Model.ReviewingProducts)
						{
							<tr>
								<td>@product.productName</td>
								<td>$@product.price</td>
								<td>@product.stock</td>
								<td>@(product.launchTime.HasValue ? product.launchTime.Value.ToString("yyyy-MM-dd") : "")</td>
								<td>
								    <button class="btn btn-custom me-2">編輯</button>
								    <button class="btn btn-custom">取消審核</button>
								</td>
							</tr>
						}
				</tbody>
			</table>
		</div>
	</div>
</div>

<!-- 商品新增的彈跳視窗 -->
<form asp-action="ProductLaunch" method="post" enctype="multipart/form-data" id="productForm">
	<div class="modal modal-n fade"
		 id="exampleModalToggle"
		 aria-hidden="true"
		 aria-labelledby="exampleModalToggleLabel"
		 tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header px-4 mx-4 pb-0 mt-2">
					<h5 class="modal-title" id="exampleModalToggleLabel">新增商品</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="col-lg-12">
						<div class="w-100 d-flex flex-column mx-auto px-lg-3 mt-lg-0">
							<!-- 商品名稱 -->
							<div class="form-control-n">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">商品名稱<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="text"
									   id="productName"
									   name="productName"
									   placeholder="請輸入商品名稱"
									   aria-label="商品名稱" />
							</div>

							<!-- 商品價格 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">商品價格<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="number"
									   id="price"
									   name="price"
									   placeholder="請輸入商品價格"
									   aria-label="商品價格" />
							</div>

							<!-- 庫存數量 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">庫存數量<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="number"
									   id="stock"
									   name="stock"
									   placeholder="請輸入庫存數量"
									   aria-label="庫存數量" />
							</div>

							<!-- 商品分類 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">商品分類<span></span></div>
								</div>
								<select class="form-select"
										id="subcategoryNo"
										name="subcategoryNo">
									<!-- 動態生成選項 -->
									@foreach (var subcategory in ViewBag.Subcategories)
									{
										<option value="@subcategory.SubcategoryNo">@subcategory.SubcategoryName</option>
									}
								</select>
							</div>

							<!-- 品項分類 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">品項分類<span></span></div>
								</div>
								<select class="form-select"
										id="itemNo"
										name="itemNo">
									<!-- 動態生成選項 -->
									@foreach (var item in ViewBag.Items)
									{
										<option value="@item.ItemNo">@item.ItemName</option>
									}
								</select>
							</div>

							<!-- 商品描述 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">商品描述<span></span></div>
								</div>
								<textarea class="form-control form-control-sm"
										  id="description"
										  name="description"
										  rows="3"
										  placeholder="請輸入商品描述"
										  aria-label="商品描述"></textarea>
							</div>

							<!-- 單位數量 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">單位數量<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="number"
									   id="quantity"
									   name="quantity"
									   placeholder="請輸入商品單位數量"
									   aria-label="單位數量" />
							</div>

							<!-- 重量 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">重量(g)<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="number"
									   id="weight"
									   name="weight"
									   placeholder="請輸入商品重量"
									   aria-label="重量" />
							</div>

							<!-- 成分 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">成分<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="text"
									   id="component"
									   name="component"
									   placeholder="請輸入商品成分"
									   aria-label="成分" />
							</div>

							<!-- 折扣百分比 -->
							<div class="form-control-n mt-3">
								<div class="title mb-2 d-flex justify-content-between">
									<div class="allcoin">折扣比率<span></span></div>
								</div>
								<input class="form-control form-control-sm"
									   type="number"
									   step="0.01"
									   min="0" max="1"
									   id="discountPercent"
									   name="discountPercent"
									   placeholder="請輸入折扣比率"
									   aria-label="折扣比率" />
							</div>

							<!-- 送出按鈕 -->
							<div class="w-100 submit mt-4 mb-3">
								<button class="btn dark-btn-n" type="submit" id="confirmSubmitButton">
									送出
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>

<!-- 確認送出的 Modal -->
<div class="modal fade" id="confirmSubmitModal" tabindex="-1" aria-labelledby="confirmSubmitModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-sm">
		<!-- 調整寬度為小 -->
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="confirmSubmitModalLabel">確認送出</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				您是否要送出商品上架資料？
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">否</button>
				<button type="button" class="btn btn-primary" id="confirmSubmitYes">是</button>
			</div>
		</div>
	</div>
</div>


<!-- Bootstrap Toast 結構 -->
@if (TempData["success"] != null)
{
	<div aria-live="polite" aria-atomic="true" class="position-relative">
		<div class="toast-container position-fixed bottom-0 end-0 p-3">
			<div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
				<div class="toast-header">
					<img src="~/assets/brand/common/circle.png" class="rounded me-2" alt="check icon" width="16" height="16">
					<strong class="me-auto">通知</strong>
					<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
				</div>
				<div class="toast-body">
					@TempData["success"]
				</div>
			</div>
		</div>
	</div>
}

@section Scripts {

    <script>
		$(document).ready(function () {
			var table = $('#example').DataTable({
				scrollX: true, // 啟用水平滾動
				fixedHeader: true, // 啟用固定表頭
			});
		});

		//商品上架表單送出按鈕跳出確認Modal
		// 當點擊送出按鈕時，顯示確認的 Modal
		$(document).ready(function () {
			$('#confirmSubmitButton').click(function (e) {
				e.preventDefault(); // 阻止表單的默認提交
				$('#confirmSubmitModal').modal('show');
			});
		})

		// 當使用者按下 "是" 時，提交表單
		$(document).ready(function () {
			$('#confirmSubmitYes').click(function () {
				$('#productForm').submit(); // 提交表單
				$('#confirmSubmitModal').modal('hide'); // 隱藏確認的 Modal
				$('#exampleModalToggle').modal('hide'); // 同時隱藏商品上架 Modal
			});
		})

		// 當使用者按下 "否" 時，關閉兩個 Modal
		$(document).ready(function () {
			$('#confirmSubmitModal .btn-secondary').click(function () {
				$('#confirmSubmitModal').modal('hide'); // 隱藏確認的 Modal
				$('#exampleModalToggle').modal('hide'); // 同時隱藏商品上架 Modal
			});
		})


		//當商品上架表單送出後端確認OK，會彈跳出toast通知成功
		$(document).ready(function () {
			var toastElement = $('.toast');
			if (toastElement.length > 0) {
				toastElement.toast('show');
			}
		})

    </script>

}